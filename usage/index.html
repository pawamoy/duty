<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A simple task runner."><link href=https://pawamoy.github.io/duty/usage/ rel=canonical><link href=../license/ rel=prev><link href=../reference/api/ rel=next><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.1"><title>Usage - duty</title><link rel=stylesheet href=../assets/stylesheets/main.484c7ddc.min.css><link rel=stylesheet href=../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../assets/_markdown_exec_pyodide.css><link rel=stylesheet href=../css/timeago.css><link rel=stylesheet href=../assets/_mkdocstrings.css><link rel=stylesheet href=../css/material.css><link rel=stylesheet href=../css/mkdocstrings.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#usage class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> <button class="md-banner__button md-icon" aria-label="Don't show this again"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> <strong>Fund this project</strong> through <a href=https://github.com/sponsors/pawamoy><strong>sponsorship</strong></a> <span class="twemoji heart pulse"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 16 16"><path d="M7.655 14.916zh-.002l-.006-.003-.018-.01a22 22 0 0 1-3.744-2.584C2.045 10.731 0 8.35 0 5.5 0 2.836 2.086 1 4.25 1 5.797 1 7.153 1.802 8 3.02 8.847 1.802 10.203 1 11.75 1 13.914 1 16 2.836 16 5.5c0 2.85-2.044 5.231-3.886 6.818a22 22 0 0 1-3.433 2.414 7 7 0 0 1-.31.17l-.018.01-.008.004a.75.75 0 0 1-.69 0"/></svg> </span> &mdash; Follow <strong>@pawamoy</strong> on <a rel=me href=https://fosstodon.org/@pawamoy> <span class="twemoji mastodon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M433 179.1c0-97.2-63.7-125.7-63.7-125.7-62.5-28.7-228.6-28.4-290.5 0 0 0-63.7 28.5-63.7 125.7 0 115.7-6.6 259.4 105.6 289.1 40.5 10.7 75.3 13 103.3 11.4 50.8-2.8 79.3-18.1 79.3-18.1l-1.7-36.9s-36.3 11.4-77.1 10.1c-40.4-1.4-83-4.4-89.6-54-.6-4.6-.9-9.3-.9-13.9 85.6 20.9 158.7 9.1 178.7 6.7 56.1-6.7 105-41.3 111.2-72.9 9.8-49.8 9-121.5 9-121.5zm-75.1 125.2h-46.6V190.1c0-49.7-64-51.6-64 6.9v62.5H201V197c0-58.5-64-56.6-64-6.9v114.2H90.3c0-122.1-5.2-147.9 18.4-175 25.9-28.9 79.8-30.8 103.8 6.1l11.6 19.5 11.6-19.5c24.1-37.1 78.1-34.8 103.8-6.1 23.7 27.3 18.4 53 18.4 175"/></svg> </span> <strong>Fosstodon</strong> </a> for updates </div> <script>var el=document.querySelector("[data-md-component=announce]");if(el){var content=el.querySelector(".md-typeset");__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0)}</script> </aside> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title=duty class="md-header__button md-logo" aria-label=duty data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4.41 3 3 4.41 5.69 7.1A7.92 7.92 0 0 0 4 12c0 1.85.63 3.55 1.69 4.9L3 19.59 4.41 21l2.69-2.69A7.92 7.92 0 0 0 12 20c1.85 0 3.55-.63 4.9-1.69L19.59 21 21 19.59l-2.69-2.69A7.92 7.92 0 0 0 20 12c0-1.85-.63-3.55-1.69-4.9L21 4.41 19.59 3 16.9 5.69A7.92 7.92 0 0 0 12 4c-1.85 0-3.55.63-4.9 1.69zM12 6c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6 2.69-6 6-6"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> duty </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Usage </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media=(prefers-color-scheme) data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=teal data-md-color-accent=purple aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=black data-md-color-accent=lime aria-label="Switch to system preference" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to system preference" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/pawamoy/duty title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> pawamoy/duty </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class=md-tabs__link> Home </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=./ class=md-tabs__link> Usage </a> </li> <li class=md-tabs__item> <a href=../reference/api/ class=md-tabs__link> API reference </a> </li> <li class=md-tabs__item> <a href=../contributing/ class=md-tabs__link> Development </a> </li> <li class=md-tabs__item> <a href=https://pawamoy.github.io/ class=md-tabs__link> Author's website </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation hidden> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title=duty class="md-nav__button md-logo" aria-label=duty data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4.41 3 3 4.41 5.69 7.1A7.92 7.92 0 0 0 4 12c0 1.85.63 3.55 1.69 4.9L3 19.59 4.41 21l2.69-2.69A7.92 7.92 0 0 0 12 20c1.85 0 3.55-.63 4.9-1.69L19.59 21 21 19.59l-2.69-2.69A7.92 7.92 0 0 0 20 12c0-1.85-.63-3.55-1.69-4.9L21 4.41 19.59 3 16.9 5.69A7.92 7.92 0 0 0 12 4c-1.85 0-3.55.63-4.9 1.69zM12 6c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6 2.69-6 6-6"/></svg> </a> duty </label> <div class=md-nav__source> <a href=https://github.com/pawamoy/duty title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> pawamoy/duty </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1 id=__nav_1_label tabindex=0> <span class=md-ellipsis> Home </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_1_label aria-expanded=false> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../changelog/ class=md-nav__link> <span class=md-ellipsis> Changelog </span> </a> </li> <li class=md-nav__item> <a href=../credits/ class=md-nav__link> <span class=md-ellipsis> Credits </span> </a> </li> <li class=md-nav__item> <a href=../license/ class=md-nav__link> <span class=md-ellipsis> License </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Usage </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Usage </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#writing-duties class=md-nav__link> <span class=md-ellipsis> <span class=md-typeset> Writing duties </span> </span> </a> <nav class=md-nav aria-label="Writing duties"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#lazy-callables class=md-nav__link> <span class=md-ellipsis> <span class=md-typeset> Lazy callables </span> </span> </a> </li> <li class=md-nav__item> <a href=#ctxrun-options class=md-nav__link> <span class=md-ellipsis> <span class=md-typeset> <code>ctx.run()</code> options </span> </span> </a> </li> <li class=md-nav__item> <a href=#default-options class=md-nav__link> <span class=md-ellipsis> <span class=md-typeset> Default options </span> </span> </a> </li> <li class=md-nav__item> <a href=#options-as-a-context-manager class=md-nav__link> <span class=md-ellipsis> <span class=md-typeset> Options as a context manager </span> </span> </a> </li> <li class=md-nav__item> <a href=#changing-the-working-directory class=md-nav__link> <span class=md-ellipsis> <span class=md-typeset> Changing the working directory </span> </span> </a> </li> <li class=md-nav__item> <a href=#saving-the-output-of-a-command class=md-nav__link> <span class=md-ellipsis> <span class=md-typeset> Saving the output of a command </span> </span> </a> </li> <li class=md-nav__item> <a href=#passing-standard-input-to-a-command class=md-nav__link> <span class=md-ellipsis> <span class=md-typeset> Passing standard input to a command </span> </span> </a> </li> <li class=md-nav__item> <a href=#prepost-duties class=md-nav__link> <span class=md-ellipsis> <span class=md-typeset> Pre/post duties </span> </span> </a> </li> <li class=md-nav__item> <a href=#defining-aliases class=md-nav__link> <span class=md-ellipsis> <span class=md-typeset> Defining aliases </span> </span> </a> </li> <li class=md-nav__item> <a href=#skipping-duties class=md-nav__link> <span class=md-ellipsis> <span class=md-typeset> Skipping duties </span> </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#listing-duties class=md-nav__link> <span class=md-ellipsis> <span class=md-typeset> Listing duties </span> </span> </a> </li> <li class=md-nav__item> <a href=#running-duties class=md-nav__link> <span class=md-ellipsis> <span class=md-typeset> Running duties </span> </span> </a> <nav class=md-nav aria-label="Running duties"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#passing-parameters class=md-nav__link> <span class=md-ellipsis> <span class=md-typeset> Passing parameters </span> </span> </a> </li> <li class=md-nav__item> <a href=#passing-options class=md-nav__link> <span class=md-ellipsis> <span class=md-typeset> Passing options </span> </span> </a> <nav class=md-nav aria-label="Passing options"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#global-options class=md-nav__link> <span class=md-ellipsis> <span class=md-typeset> Global options </span> </span> </a> </li> <li class=md-nav__item> <a href=#local-options class=md-nav__link> <span class=md-ellipsis> <span class=md-typeset> Local options </span> </span> </a> </li> <li class=md-nav__item> <a href=#preventing-options-overrides-from-the-cli class=md-nav__link> <span class=md-ellipsis> <span class=md-typeset> Preventing options overrides from the CLI </span> </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#capturing-commands-output class=md-nav__link> <span class=md-ellipsis> <span class=md-typeset> Capturing commands output </span> </span> </a> </li> <li class=md-nav__item> <a href=#formatting-duty-output class=md-nav__link> <span class=md-ellipsis> <span class=md-typeset> Formatting duty output </span> </span> </a> </li> <li class=md-nav__item> <a href=#shell-completions class=md-nav__link> <span class=md-ellipsis> <span class=md-typeset> Shell completions </span> </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../reference/api/ class=md-nav__link> <span class=md-ellipsis> API reference </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Development </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Development </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../contributing/ class=md-nav__link> <span class=md-ellipsis> Contributing </span> </a> </li> <li class=md-nav__item> <a href=../code_of_conduct/ class=md-nav__link> <span class=md-ellipsis> Code of Conduct </span> </a> </li> <li class=md-nav__item> <a href=../coverage/ class=md-nav__link> <span class=md-ellipsis> Coverage report </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=https://pawamoy.github.io/ class=md-nav__link> <span class=md-ellipsis> Author's website </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#writing-duties class=md-nav__link> <span class=md-ellipsis> <span class=md-typeset> Writing duties </span> </span> </a> <nav class=md-nav aria-label="Writing duties"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#lazy-callables class=md-nav__link> <span class=md-ellipsis> <span class=md-typeset> Lazy callables </span> </span> </a> </li> <li class=md-nav__item> <a href=#ctxrun-options class=md-nav__link> <span class=md-ellipsis> <span class=md-typeset> <code>ctx.run()</code> options </span> </span> </a> </li> <li class=md-nav__item> <a href=#default-options class=md-nav__link> <span class=md-ellipsis> <span class=md-typeset> Default options </span> </span> </a> </li> <li class=md-nav__item> <a href=#options-as-a-context-manager class=md-nav__link> <span class=md-ellipsis> <span class=md-typeset> Options as a context manager </span> </span> </a> </li> <li class=md-nav__item> <a href=#changing-the-working-directory class=md-nav__link> <span class=md-ellipsis> <span class=md-typeset> Changing the working directory </span> </span> </a> </li> <li class=md-nav__item> <a href=#saving-the-output-of-a-command class=md-nav__link> <span class=md-ellipsis> <span class=md-typeset> Saving the output of a command </span> </span> </a> </li> <li class=md-nav__item> <a href=#passing-standard-input-to-a-command class=md-nav__link> <span class=md-ellipsis> <span class=md-typeset> Passing standard input to a command </span> </span> </a> </li> <li class=md-nav__item> <a href=#prepost-duties class=md-nav__link> <span class=md-ellipsis> <span class=md-typeset> Pre/post duties </span> </span> </a> </li> <li class=md-nav__item> <a href=#defining-aliases class=md-nav__link> <span class=md-ellipsis> <span class=md-typeset> Defining aliases </span> </span> </a> </li> <li class=md-nav__item> <a href=#skipping-duties class=md-nav__link> <span class=md-ellipsis> <span class=md-typeset> Skipping duties </span> </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#listing-duties class=md-nav__link> <span class=md-ellipsis> <span class=md-typeset> Listing duties </span> </span> </a> </li> <li class=md-nav__item> <a href=#running-duties class=md-nav__link> <span class=md-ellipsis> <span class=md-typeset> Running duties </span> </span> </a> <nav class=md-nav aria-label="Running duties"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#passing-parameters class=md-nav__link> <span class=md-ellipsis> <span class=md-typeset> Passing parameters </span> </span> </a> </li> <li class=md-nav__item> <a href=#passing-options class=md-nav__link> <span class=md-ellipsis> <span class=md-typeset> Passing options </span> </span> </a> <nav class=md-nav aria-label="Passing options"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#global-options class=md-nav__link> <span class=md-ellipsis> <span class=md-typeset> Global options </span> </span> </a> </li> <li class=md-nav__item> <a href=#local-options class=md-nav__link> <span class=md-ellipsis> <span class=md-typeset> Local options </span> </span> </a> </li> <li class=md-nav__item> <a href=#preventing-options-overrides-from-the-cli class=md-nav__link> <span class=md-ellipsis> <span class=md-typeset> Preventing options overrides from the CLI </span> </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#capturing-commands-output class=md-nav__link> <span class=md-ellipsis> <span class=md-typeset> Capturing commands output </span> </span> </a> </li> <li class=md-nav__item> <a href=#formatting-duty-output class=md-nav__link> <span class=md-ellipsis> <span class=md-typeset> Formatting duty output </span> </span> </a> </li> <li class=md-nav__item> <a href=#shell-completions class=md-nav__link> <span class=md-ellipsis> <span class=md-typeset> Shell completions </span> </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/pawamoy/duty/edit/main/docs/usage.md title="Edit this page" class="md-content__button md-icon" rel=edit> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg> </a> <a href=https://github.com/pawamoy/duty/raw/main/docs/usage.md title="View source of this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg> </a> <h1 id=usage>Usage<a class=headerlink href=#usage title="Permanent link">¤</a></h1> <h2 id=writing-duties>Writing duties<a class=headerlink href=#writing-duties title="Permanent link">¤</a></h2> <p>Your tasks, or duties, are defined in a Python module. By default, <code>duty</code> will load these tasks from a <code>duties.py</code> file at the root of your repository.</p> <p>Each task is declared as a "duty", using the <code>duty.duty</code> decorator.</p> <div class=highlight><pre><span></span><code><span class=kn>from</span><span class=w> </span><span class=nn>duty</span><span class=w> </span><span class=kn>import</span> <span class=n>duty</span>


<span class=nd>@duty</span>
<span class=k>def</span><span class=w> </span><span class=nf>docs</span><span class=p>(</span><span class=n>ctx</span><span class=p>):</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;mkdocs build&quot;</span><span class=p>,</span> <span class=n>title</span><span class=o>=</span><span class=s2>&quot;Building documentation&quot;</span><span class=p>)</span>
</code></pre></div> <p>The <code>ctx</code> argument is the "context" of the duty. It is automatically created and passed to your function.</p> <p>It has only one purpose: running command with its <code>run</code> method. The <code>run</code> method accepts strings, list of strings, or even Python callables.</p> <p>The above duty runs the command in a shell process. To avoid using a shell, pass a list of strings instead:</p> <div class=highlight><pre><span></span><code><span class=kn>from</span><span class=w> </span><span class=nn>duty</span><span class=w> </span><span class=kn>import</span> <span class=n>duty</span>


<span class=nd>@duty</span>
<span class=k>def</span><span class=w> </span><span class=nf>docs</span><span class=p>(</span><span class=n>ctx</span><span class=p>):</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>([</span><span class=s2>&quot;mkdocs&quot;</span><span class=p>,</span> <span class=s2>&quot;build&quot;</span><span class=p>],</span> <span class=n>title</span><span class=o>=</span><span class=s2>&quot;Building documentation&quot;</span><span class=p>)</span>
    <span class=c1># avoid the overhead of an extra shell process</span>
</code></pre></div> <p>And to avoid using a subprocess completely, pass a Python callable:</p> <div class=highlight><pre><span></span><code><span class=kn>from</span><span class=w> </span><span class=nn>duty</span><span class=w> </span><span class=kn>import</span> <span class=n>duty</span>
<span class=kn>from</span><span class=w> </span><span class=nn>mkdocs</span><span class=w> </span><span class=kn>import</span> <span class=n>build</span><span class=p>,</span> <span class=n>config</span>


<span class=nd>@duty</span>
<span class=k>def</span><span class=w> </span><span class=nf>docs</span><span class=p>(</span><span class=n>ctx</span><span class=p>):</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>build</span><span class=o>.</span><span class=n>build</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>[</span><span class=n>config</span><span class=o>.</span><span class=n>load_config</span><span class=p>()],</span> <span class=n>title</span><span class=o>=</span><span class=s2>&quot;Building documentation&quot;</span><span class=p>)</span>
    <span class=c1># avoid the overhead of an extra Python process</span>
</code></pre></div> <p>For convenience, <code>duty</code> provides callables (called "tools") for many popular Python tools, so that you don't have to read their source and learn how to call them. For example, the <code>mkdocs build</code> command can be called like this:</p> <div class=highlight><pre><span></span><code><span class=kn>from</span><span class=w> </span><span class=nn>duty</span><span class=w> </span><span class=kn>import</span> <span class=n>duty</span><span class=p>,</span> <span class=n>tools</span>


<span class=nd>@duty</span>
<span class=k>def</span><span class=w> </span><span class=nf>docs</span><span class=p>(</span><span class=n>ctx</span><span class=p>):</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>tool</span><span class=o>.</span><span class=n>mkdocs</span><span class=o>.</span><span class=n>build</span><span class=p>,</span> <span class=n>kwargs</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;strict&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>},</span> <span class=n>title</span><span class=o>=</span><span class=s2>&quot;Building documentation&quot;</span><span class=p>)</span>
</code></pre></div> <h3 id=lazy-callables>Lazy callables<a class=headerlink href=#lazy-callables title="Permanent link">¤</a></h3> <div class="admonition tip"> <p class=admonition-title>Our callables are lazy!</p> </div> <p>Not only imports to third-party modules are deferred when our callables run, but the callables themselves are lazy, meaning you can call them directly, without passing arguments and keyword arguments with the <code>args</code> and <code>kwargs</code> parameters of <code>ctx.run()</code>:</p> <div class=highlight><pre><span></span><code><span class=kn>from</span><span class=w> </span><span class=nn>duty</span><span class=w> </span><span class=kn>import</span> <span class=n>duty</span><span class=p>,</span> <span class=n>tools</span>


<span class=nd>@duty</span>
<span class=k>def</span><span class=w> </span><span class=nf>docs</span><span class=p>(</span><span class=n>ctx</span><span class=p>):</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>tools</span><span class=o>.</span><span class=n>mkdocs</span><span class=o>.</span><span class=n>build</span><span class=p>(</span><span class=n>strict</span><span class=o>=</span><span class=kc>True</span><span class=p>),</span> <span class=n>title</span><span class=o>=</span><span class=s2>&quot;Building documentation&quot;</span><span class=p>)</span>
</code></pre></div> <p>The main benefit is that it enables IDE features like help tooltips and auto-completion, as well as improving readability and writability.</p> <p><strong><a class="autorefs autorefs-internal" href=../reference/api/#duty.tools>See all our tools in the Code reference</a>.</strong></p> <p>You can also create your own lazy callables with <a class="autorefs autorefs-internal" href=../reference/api/#duty.Tool><code>duty.Tool</code></a> and <a class="autorefs autorefs-internal" href=../reference/api/#duty.lazy><code>duty.lazy</code></a>. Check out our tools to see how to create your own.</p> <p>The <code>lazy</code> function/decorator is a quicker way to create a lazy callable:</p> <div class=highlight><pre><span></span><code><span class=kn>from</span><span class=w> </span><span class=nn>duty</span><span class=w> </span><span class=kn>import</span> <span class=n>duty</span><span class=p>,</span> <span class=n>tools</span>

<span class=kn>from</span><span class=w> </span><span class=nn>griffe.cli</span><span class=w> </span><span class=kn>import</span> <span class=n>check</span>


<span class=nd>@duty</span>
<span class=k>def</span><span class=w> </span><span class=nf>check_api</span><span class=p>(</span><span class=n>ctx</span><span class=p>):</span>
    <span class=n>griffe_check</span> <span class=o>=</span> <span class=n>tools</span><span class=o>.</span><span class=n>lazy</span><span class=p>(</span><span class=n>check</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=s2>&quot;griffe.check&quot;</span><span class=p>)</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>griffe_check</span><span class=p>(</span><span class=s2>&quot;pkg&quot;</span><span class=p>))</span>
</code></pre></div> <h3 id=ctxrun-options><code>ctx.run()</code> options<a class=headerlink href=#ctxrun-options title="Permanent link">¤</a></h3> <p>The <code>run</code> methods accepts various options, mostly coming from its underlying dependency: <a href=https://github.com/pawamoy/failprint><code>failprint</code></a>.</p> <p><strong>Arguments of the <code>run</code> method:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td>cmd</td> <td><code>str</code>, <code>list of str</code>, or Python callable</td> <td>The command to run.</td> <td><em>required</em></td> </tr> <tr> <td>args</td> <td><code>list</code></td> <td>Arguments to pass to the callable.</td> <td><code>[]</code></td> </tr> <tr> <td>kwargs</td> <td><code>dict</code></td> <td>Keyword arguments to pass to the callable.</td> <td><code>{}</code></td> </tr> <tr> <td>number</td> <td><code>int</code></td> <td>The command number (useful for the <code>tap</code> format).</td> <td><code>None</code></td> </tr> <tr> <td>capture</td> <td><code>str</code></td> <td>The type of output: <code>"stdout"</code>, <code>"stderr"</code>, <code>"both"</code> (or <code>True</code>) and <code>"none"</code> (or <code>False</code>)</td> <td><code>True</code></td> </tr> <tr> <td>title</td> <td><code>str</code></td> <td>The command title.</td> <td><em>cmd as a shell command or Python statement</em></td> </tr> <tr> <td>fmt</td> <td><code>str</code></td> <td>The output format as a Jinja template: <code>"pretty"</code>, <code>"tap"</code> or <code>"custom=..."</code></td> <td><code>"pretty"</code></td> </tr> <tr> <td>pty</td> <td><code>bool</code></td> <td>Whether to run in a PTY.</td> <td><code>False</code></td> </tr> <tr> <td>progress</td> <td><code>bool</code></td> <td>Whether to show progress.</td> <td><code>True</code></td> </tr> <tr> <td>nofail</td> <td><code>bool</code></td> <td>Whether to always succeed.</td> <td><code>False</code></td> </tr> <tr> <td>quiet</td> <td><code>bool</code></td> <td>Don't print the command output, even if it failed.</td> <td><code>False</code></td> </tr> <tr> <td>silent</td> <td><code>bool</code></td> <td>Don't print anything.</td> <td><code>False</code></td> </tr> <tr> <td>stdin</td> <td><code>str</code></td> <td>Pass text to a command as standard input.</td> <td><code>None</code></td> </tr> <tr> <td>workdir</td> <td><code>str</code></td> <td>Change the working directory.</td> <td><code>None</code></td> </tr> <tr> <td>command</td> <td><code>str</code></td> <td>The shell command equivalent to <code>cmd</code>, to show how to run it without duty (useful when passing Python callables).</td> <td>stringified <code>cmd</code></td> </tr> <tr> <td>allow_overrides</td> <td><code>bool</code></td> <td>Allow options overrides via CLI arguments.</td> <td><code>True</code></td> </tr> </tbody> </table> <p>Example usage of the <code>silent</code> option:</p> <div class=highlight><pre><span></span><code><span class=nd>@duty</span>
<span class=k>def</span><span class=w> </span><span class=nf>clean</span><span class=p>(</span><span class=n>ctx</span><span class=p>):</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;find . -type d -name __pycache__ | xargs rm -rf&quot;</span><span class=p>,</span> <span class=n>silent</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</code></pre></div> <h3 id=default-options>Default options<a class=headerlink href=#default-options title="Permanent link">¤</a></h3> <p>Let's say you have more than one command, and you want to silence all of them. Instead of passing <code>silent=True</code> to all <code>ctx.run()</code> calls, you can set this option as default in the decorator itself:</p> <div class=highlight><pre><span></span><code><span class=nd>@duty</span><span class=p>(</span><span class=n>silent</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<span class=k>def</span><span class=w> </span><span class=nf>clean</span><span class=p>(</span><span class=n>ctx</span><span class=p>):</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;rm -rf .coverage*&quot;</span><span class=p>)</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;rm -rf .mypy_cache&quot;</span><span class=p>)</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;rm -rf .pytest_cache&quot;</span><span class=p>)</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;rm -rf build&quot;</span><span class=p>)</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;rm -rf dist&quot;</span><span class=p>)</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;rm -rf pip-wheel-metadata&quot;</span><span class=p>)</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;rm -rf site&quot;</span><span class=p>)</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;find . -type d -name __pycache__ | xargs rm -rf&quot;</span><span class=p>)</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;find . -name &#39;*.rej&#39; -delete&quot;</span><span class=p>)</span>
</code></pre></div> <p>You can of course override the default options in the <code>ctx.run()</code> calls:</p> <div class=highlight><pre><span></span><code><span class=nd>@duty</span><span class=p>(</span><span class=n>capture</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<span class=k>def</span><span class=w> </span><span class=nf>run_scripts</span><span class=p>(</span><span class=n>ctx</span><span class=p>):</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;bash script1.sh&quot;</span><span class=p>)</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;bash script2.sh&quot;</span><span class=p>)</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;bash script3.sh&quot;</span><span class=p>,</span> <span class=n>capture</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</code></pre></div> <h3 id=options-as-a-context-manager>Options as a context manager<a class=headerlink href=#options-as-a-context-manager title="Permanent link">¤</a></h3> <p>You can temporarily change options for several <code>run</code> calls with <code>ctx.options()</code>:</p> <div class=highlight><pre><span></span><code><span class=nd>@duty</span>
<span class=k>def</span><span class=w> </span><span class=nf>run_scripts</span><span class=p>(</span><span class=n>ctx</span><span class=p>):</span>
    <span class=k>with</span> <span class=n>ctx</span><span class=o>.</span><span class=n>options</span><span class=p>(</span><span class=n>nofail</span><span class=o>=</span><span class=kc>True</span><span class=p>):</span>
        <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;bash script1.sh&quot;</span><span class=p>)</span>
        <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;bash script2.sh&quot;</span><span class=p>)</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;bash script3.sh&quot;</span><span class=p>)</span>
</code></pre></div> <p>Such temporary changes will stack above the previous ones each time you enter the <code>with</code> clause, and unstack each time you leave it:</p> <div class=highlight><pre><span></span><code><span class=nd>@duty</span>
<span class=k>def</span><span class=w> </span><span class=nf>run_scripts</span><span class=p>(</span><span class=n>ctx</span><span class=p>):</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;bash script0.sh&quot;</span><span class=p>)</span>  <span class=c1># defaults</span>

    <span class=k>with</span> <span class=n>ctx</span><span class=o>.</span><span class=n>options</span><span class=p>(</span><span class=n>nofail</span><span class=o>=</span><span class=kc>True</span><span class=p>):</span>
        <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;bash script1.sh&quot;</span><span class=p>)</span>  <span class=c1># nofail=True</span>

        <span class=k>with</span> <span class=n>ctx</span><span class=o>.</span><span class=n>options</span><span class=p>(</span><span class=n>quiet</span><span class=o>=</span><span class=kc>True</span><span class=p>):</span>
            <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;bash script2.sh&quot;</span><span class=p>)</span>  <span class=c1># nofail=True, quiet=True</span>

            <span class=k>with</span> <span class=n>ctx</span><span class=o>.</span><span class=n>options</span><span class=p>(</span><span class=n>silent</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>nofail</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
                <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;bash script3.sh&quot;</span><span class=p>)</span>  <span class=c1># nofail=False, quiet=True, silent=True</span>

            <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;bash script4.sh&quot;</span><span class=p>)</span>  <span class=c1># nofail=True, quiet=True</span>

        <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;bash script5.sh&quot;</span><span class=p>)</span>  <span class=c1># nofail=True</span>

    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;bash script6.sh&quot;</span><span class=p>)</span>  <span class=c1># defaults</span>
</code></pre></div> <h3 id=changing-the-working-directory>Changing the working directory<a class=headerlink href=#changing-the-working-directory title="Permanent link">¤</a></h3> <p>You can change the working directory for a specific <code>run</code>:</p> <div class=highlight><pre><span></span><code><span class=nd>@duty</span>
<span class=k>def</span><span class=w> </span><span class=nf>run_scripts</span><span class=p>(</span><span class=n>ctx</span><span class=p>):</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;bash script3.sh&quot;</span><span class=p>,</span> <span class=n>workdir</span><span class=o>=</span><span class=s2>&quot;subfolder&quot;</span><span class=p>)</span>
</code></pre></div> <p>Or for a group of <code>run</code> calls, using the <code>options</code> context manager:</p> <div class=highlight><pre><span></span><code><span class=nd>@duty</span>
<span class=k>def</span><span class=w> </span><span class=nf>run_scripts</span><span class=p>(</span><span class=n>ctx</span><span class=p>):</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;echo in .&quot;</span><span class=p>)</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;ls&quot;</span><span class=p>)</span>
    <span class=k>with</span> <span class=n>ctx</span><span class=o>.</span><span class=n>options</span><span class=p>(</span><span class=n>workdir</span><span class=o>=</span><span class=s2>&quot;subfolder&quot;</span><span class=p>):</span>
        <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;echo in subfolder&quot;</span><span class=p>)</span>
        <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;ls&quot;</span><span class=p>)</span>
</code></pre></div> <div class="admonition warning"> <p class=admonition-title>The change of directory is not immediate.</p> <p>When using the <code>workdir</code> option through the context manager, the actual change of directory is deferred to each of the <code>run</code> calls within that context.</p> <p>A nesting of <code>ctx.options(workdir=...)</code> will each time override the previous one:</p> <div class=highlight><pre><span></span><code><span class=nd>@duty</span>
<span class=k>def</span><span class=w> </span><span class=nf>run_scripts</span><span class=p>(</span><span class=n>ctx</span><span class=p>):</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;echo in .&quot;</span><span class=p>)</span>  <span class=c1># run in ./</span>
    <span class=k>with</span> <span class=n>ctx</span><span class=o>.</span><span class=n>options</span><span class=p>(</span><span class=n>workdir</span><span class=o>=</span><span class=s2>&quot;A&quot;</span><span class=p>):</span>
        <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;echo in A&quot;</span><span class=p>)</span>  <span class=c1># run in ./A</span>
        <span class=k>with</span> <span class=n>ctx</span><span class=o>.</span><span class=n>options</span><span class=p>(</span><span class=n>workdir</span><span class=o>=</span><span class=s2>&quot;B&quot;</span><span class=p>):</span>
            <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;echo in...&quot;</span><span class=p>)</span>  <span class=c1># run in ./B, not ./A/B!</span>
</code></pre></div> <p>It also means instructions other than <code>ctx.run</code> still run in the original directory!</p> <div class=highlight><pre><span></span><code><span class=nd>@duty</span>
<span class=k>def</span><span class=w> </span><span class=nf>run_scripts</span><span class=p>(</span><span class=n>ctx</span><span class=p>):</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;echo in .&quot;</span><span class=p>)</span>  <span class=c1># run in ./</span>
    <span class=k>with</span> <span class=n>ctx</span><span class=o>.</span><span class=n>options</span><span class=p>(</span><span class=n>workdir</span><span class=o>=</span><span class=s2>&quot;A&quot;</span><span class=p>):</span>
        <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;echo in A&quot;</span><span class=p>)</span>  <span class=c1># run in ./A</span>
        <span class=n>l</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>listdir</span><span class=p>()</span>  <span class=c1># run in ./, not ./A!</span>
</code></pre></div> <p>If you want to immediately enter the directory, or to nest multiple directory changes, use the <code>cd</code> context manager.</p> </div> <p>Another way to change the working directory is to use the <code>ctx.cd(directory)</code> context manager:</p> <div class=highlight><pre><span></span><code><span class=nd>@duty</span>
<span class=k>def</span><span class=w> </span><span class=nf>run_scripts</span><span class=p>(</span><span class=n>ctx</span><span class=p>):</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;echo in .&quot;</span><span class=p>)</span>  <span class=c1># run in ./</span>

    <span class=k>with</span> <span class=n>ctx</span><span class=o>.</span><span class=n>cd</span><span class=p>(</span><span class=s2>&quot;A&quot;</span><span class=p>):</span>
        <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;echo in A&quot;</span><span class=p>)</span>  <span class=c1># run in ./A</span>
        <span class=n>l</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>listdir</span><span class=p>()</span>  <span class=c1># run in ./A as well</span>

        <span class=k>with</span> <span class=n>ctx</span><span class=o>.</span><span class=n>cd</span><span class=p>(</span><span class=s2>&quot;B&quot;</span><span class=p>):</span>
            <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;echo in A/B&quot;</span><span class=p>)</span>  <span class=c1># run in ./A/B</span>
            <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;echo in A/B/C&quot;</span><span class=p>,</span> <span class=n>workdir</span><span class=o>=</span><span class=s2>&quot;C&quot;</span><span class=p>)</span>  <span class=c1># run in ./A/B/C</span>

        <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;echo in A&quot;</span><span class=p>)</span>  <span class=c1># back to ./A</span>

    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;echo in .&quot;</span><span class=p>)</span>  <span class=c1># back to ./</span>
</code></pre></div> <h3 id=saving-the-output-of-a-command>Saving the output of a command<a class=headerlink href=#saving-the-output-of-a-command title="Permanent link">¤</a></h3> <p>In <em>duty</em> 0.7 (thanks to <em>failprint</em> 0.8), the <code>run</code> method of the context objects always returns the captured output of the command (even when it also prints it on the standard output). If nothing was captured, the returned output will be empty.</p> <p>You can therefore use <code>ctx.run</code> as a shortcut to get the output of a command.</p> <p>Before <em>duty</em> 0.7:</p> <div class=highlight><pre><span></span><code><span class=kn>import</span><span class=w> </span><span class=nn>subprocess</span>

<span class=kn>from</span><span class=w> </span><span class=nn>duty</span><span class=w> </span><span class=kn>import</span> <span class=n>duty</span>


<span class=nd>@duty</span>
<span class=k>def</span><span class=w> </span><span class=nf>action</span><span class=p>(</span><span class=n>ctx</span><span class=p>):</span>
    <span class=n>requirements</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
        <span class=p>[</span><span class=s2>&quot;pip&quot;</span><span class=p>,</span> <span class=s2>&quot;freeze&quot;</span><span class=p>],</span>
        <span class=n>stdout</span><span class=o>=</span><span class=n>subprocess</span><span class=o>.</span><span class=n>PIPE</span><span class=p>,</span>
        <span class=n>stderr</span><span class=o>=</span><span class=n>subprocess</span><span class=o>.</span><span class=n>STDOUT</span><span class=p>,</span>
        <span class=n>text</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
    <span class=p>)</span><span class=o>.</span><span class=n>output</span>
    <span class=o>...</span>
</code></pre></div> <p>With <em>duty</em> 0.7:</p> <div class=highlight><pre><span></span><code><span class=kn>from</span><span class=w> </span><span class=nn>duty</span><span class=w> </span><span class=kn>import</span> <span class=n>duty</span>


<span class=nd>@duty</span>
<span class=k>def</span><span class=w> </span><span class=nf>action</span><span class=p>(</span><span class=n>ctx</span><span class=p>):</span>
    <span class=n>requirements</span> <span class=o>=</span> <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>([</span><span class=s2>&quot;pip&quot;</span><span class=p>,</span> <span class=s2>&quot;freeze&quot;</span><span class=p>])</span>
    <span class=o>...</span>
</code></pre></div> <h3 id=passing-standard-input-to-a-command>Passing standard input to a command<a class=headerlink href=#passing-standard-input-to-a-command title="Permanent link">¤</a></h3> <p><em>failprint</em> 0.8 introduced the ability to pass text as standard input to a command. <em>duty</em> 0.7 takes advantage of this new <em>failprint</em> version, and therefore allows you to do the same in your duties.</p> <p>Before <em>duty</em> 0.7, to pass standard input to a command, you had to write a shell command, for example:</p> <div class=highlight><pre><span></span><code><span class=nd>@duty</span>
<span class=k>def</span><span class=w> </span><span class=nf>check_dependencies</span><span class=p>(</span><span class=n>ctx</span><span class=p>):</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
        <span class=s2>&quot;pdm export -f requirements --without-hashes | safety check --stdin --full-report&quot;</span><span class=p>,</span>
        <span class=n>title</span><span class=o>=</span><span class=s2>&quot;Checking dependencies&quot;</span><span class=p>,</span>
    <span class=p>)</span>
</code></pre></div> <p>This had a few issues:</p> <ul> <li>you had to use a shell command, which brings its lot of platform-and-shell-dependent issues, such as:<ul> <li>shell might not be the same everywhere</li> <li>on Windows, there were high chances the <code>safety</code> executable would not be found</li> </ul> </li> </ul> <p>To fix the latter, you had to compute the absolute paths of all exectuables in the command before-hand (except the first one, which <em>failprint</em> handles itself):</p> <div class=highlight><pre><span></span><code><span class=nd>@duty</span>
<span class=k>def</span><span class=w> </span><span class=nf>check_dependencies</span><span class=p>(</span><span class=n>ctx</span><span class=p>):</span>
    <span class=n>safety</span> <span class=o>=</span> <span class=n>which</span><span class=p>(</span><span class=s2>&quot;safety&quot;</span><span class=p>)</span> <span class=ow>or</span> <span class=s2>&quot;safety&quot;</span>  <span class=c1># hope for the best</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
        <span class=sa>f</span><span class=s2>&quot;pdm export -f requirements --without-hashes | </span><span class=si>{</span><span class=n>safety</span><span class=si>}</span><span class=s2> check --stdin --full-report&quot;</span><span class=p>,</span>
        <span class=n>title</span><span class=o>=</span><span class=s2>&quot;Checking dependencies&quot;</span><span class=p>,</span>
        <span class=n>pty</span><span class=o>=</span><span class=n>PTY</span><span class=p>,</span>
    <span class=p>)</span>
</code></pre></div> <p>With <em>duty</em> 0.7, everything is easier and more robust since you can save the output of a command in a variable, and then pass this variable as standard input to another command! This allows to write commands as lists of strings (better cross-platform support, less resource-consuming), and reuse the output of one command as input of several others:</p> <div class=highlight><pre><span></span><code><span class=nd>@duty</span>
<span class=k>def</span><span class=w> </span><span class=nf>check_dependencies</span><span class=p>(</span><span class=n>ctx</span><span class=p>):</span>
    <span class=n>requirements</span> <span class=o>=</span> <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
        <span class=p>[</span><span class=s2>&quot;pdm&quot;</span><span class=p>,</span> <span class=s2>&quot;export&quot;</span><span class=p>,</span> <span class=s2>&quot;-f&quot;</span><span class=p>,</span> <span class=s2>&quot;requirements&quot;</span><span class=p>,</span> <span class=s2>&quot;--without-hashes&quot;</span><span class=p>],</span>
        <span class=n>title</span><span class=o>=</span><span class=s2>&quot;Exporting dependencies as requirements&quot;</span><span class=p>,</span>
        <span class=n>allow_overrides</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
        <span class=c1># this is a preparation command that must not be altered</span>
        <span class=c1># by CLI options targetted at the next commands,</span>
        <span class=c1># see &quot;Preventing options overrides&quot;</span>
    <span class=p>)</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
        <span class=p>[</span><span class=s2>&quot;safety&quot;</span><span class=p>,</span> <span class=s2>&quot;check&quot;</span><span class=p>,</span> <span class=s2>&quot;--stdin&quot;</span><span class=p>,</span> <span class=s2>&quot;--full-report&quot;</span><span class=p>],</span>
        <span class=n>title</span><span class=o>=</span><span class=s2>&quot;Checking dependencies&quot;</span><span class=p>,</span>
        <span class=n>stdin</span><span class=o>=</span><span class=n>requirements</span><span class=p>,</span>
    <span class=p>)</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span>
        <span class=p>[</span><span class=s2>&quot;other&quot;</span><span class=p>,</span> <span class=s2>&quot;command&quot;</span><span class=p>,</span> <span class=s2>&quot;using&quot;</span><span class=p>,</span> <span class=s2>&quot;requirements&quot;</span><span class=p>],</span>
        <span class=n>title</span><span class=o>=</span><span class=s2>&quot;Checking one more thing&quot;</span><span class=p>,</span>
        <span class=n>stdin</span><span class=o>=</span><span class=n>requirements</span><span class=p>,</span>
    <span class=p>)</span>
</code></pre></div> <h3 id=prepost-duties>Pre/post duties<a class=headerlink href=#prepost-duties title="Permanent link">¤</a></h3> <p>Each duty can be configured to run other duties before or after itself, with the <code>pre</code> and <code>post</code> decorator options.</p> <p>The <code>pre</code> and <code>post</code> options accept a list of other duties to run. These other duties can be passed directly, or can be looked up using their names. You can also pass any callable that accepts a context argument, just like any duty.</p> <p>For example, you can create a composite duty <code>check</code> that calls other, more specific checking duties:</p> <div class=highlight><pre><span></span><code><span class=c1># looking up duties thanks to their names, allowing to reference duties</span>
<span class=c1># that have not yet been declared in the collection</span>
<span class=nd>@duty</span><span class=p>(</span><span class=n>pre</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;check_quality&quot;</span><span class=p>,</span> <span class=s2>&quot;check_types&quot;</span><span class=p>,</span> <span class=s2>&quot;check_docs&quot;</span><span class=p>,</span> <span class=s2>&quot;check_dependencies&quot;</span><span class=p>])</span>
<span class=k>def</span><span class=w> </span><span class=nf>check</span><span class=p>(</span><span class=n>ctx</span><span class=p>):</span>
<span class=w>    </span><span class=sd>&quot;&quot;&quot;Check it all!&quot;&quot;&quot;</span>
</code></pre></div> <p>Or you can make sure to always run the <code>clean</code> duty before running your tests, and print a coverage report after running them:</p> <div class=highlight><pre><span></span><code><span class=nd>@duty</span>
<span class=k>def</span><span class=w> </span><span class=nf>clean</span><span class=p>(</span><span class=n>ctx</span><span class=p>):</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;rm -rf tests/tmp&quot;</span><span class=p>)</span>


<span class=nd>@duty</span>
<span class=k>def</span><span class=w> </span><span class=nf>coverage</span><span class=p>(</span><span class=n>ctx</span><span class=p>):</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;coverage combine&quot;</span><span class=p>,</span> <span class=n>nofail</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;coverage report&quot;</span><span class=p>,</span> <span class=n>capture</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>


<span class=nd>@duty</span><span class=p>(</span><span class=n>pre</span><span class=o>=</span><span class=p>[</span><span class=n>clean</span><span class=p>],</span> <span class=n>post</span><span class=o>=</span><span class=p>[</span><span class=n>coverage</span><span class=p>])</span>
<span class=k>def</span><span class=w> </span><span class=nf>test</span><span class=p>(</span><span class=n>ctx</span><span class=p>):</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;pytest tests&quot;</span><span class=p>)</span>
</code></pre></div> <div class="admonition important"> <p class=admonition-title>Important</p> <p>The pre/post duties will be passed the context of the running duty. This allows to alter the behavior in both the running duties, as well as its pre/post duties. If you wish to run the pre/post duties with unaltered context, you can pass a lambda that calls their <code>run</code> method:</p> <div class=highlight><pre><span></span><code><span class=nd>@duty</span><span class=p>(</span><span class=n>nofail</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>capture</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
<span class=k>def</span><span class=w> </span><span class=nf>coverage</span><span class=p>(</span><span class=n>ctx</span><span class=p>):</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;coverage combine&quot;</span><span class=p>)</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;coverage report&quot;</span><span class=p>)</span>


<span class=nd>@duty</span><span class=p>(</span><span class=n>post</span><span class=o>=</span><span class=p>[</span><span class=k>lambda</span> <span class=n>ctx</span><span class=p>:</span> <span class=n>coverage</span><span class=o>.</span><span class=n>run</span><span class=p>()])</span>
<span class=k>def</span><span class=w> </span><span class=nf>test</span><span class=p>(</span><span class=n>ctx</span><span class=p>):</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;pytest tests&quot;</span><span class=p>)</span>
</code></pre></div> </div> <h3 id=defining-aliases>Defining aliases<a class=headerlink href=#defining-aliases title="Permanent link">¤</a></h3> <p>Duties can have aliases. By default, duty will create an alias for each duty by replacing underscores with dashes. It means that, even if you duty is called <code>check_docs</code>, you can call it with <code>duty check-docs</code> on the command line, or reference it using <code>check-docs</code> in pre/post duties.</p> <p>If you wish to add more aliases to a duty (for example to provide shorter names), use the decorator <code>aliases</code> option:</p> <div class=highlight><pre><span></span><code><span class=nd>@duty</span><span class=p>(</span><span class=n>aliases</span><span class=o>=</span><span class=p>[</span><span class=s2>&quot;start&quot;</span><span class=p>,</span> <span class=s2>&quot;up&quot;</span><span class=p>])</span>
<span class=k>def</span><span class=w> </span><span class=nf>start_backend</span><span class=p>(</span><span class=n>ctx</span><span class=p>):</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;docker-compose up&quot;</span><span class=p>)</span>
</code></pre></div> <p>With this example, you'll be able to start the backend with any of the four equivalent commands:</p> <div class=highlight><pre><span></span><code>duty<span class=w> </span>start_backend
duty<span class=w> </span>start-backend
duty<span class=w> </span>start
duty<span class=w> </span>up
</code></pre></div> <h3 id=skipping-duties>Skipping duties<a class=headerlink href=#skipping-duties title="Permanent link">¤</a></h3> <p>You can tell duty to always skip a duty if a certain condition is met. This feature is inspired by pytest's <code>skip_if</code> marker.</p> <div class=highlight><pre><span></span><code><span class=nd>@duty</span><span class=p>(</span>
    <span class=n>skip_if</span><span class=o>=</span><span class=n>sys</span><span class=o>.</span><span class=n>version_info</span> <span class=o>&lt;</span> <span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>8</span><span class=p>),</span>
    <span class=n>skip_reason</span><span class=o>=</span><span class=s2>&quot;Building docs is not supported on Python 3.7&quot;</span><span class=p>,</span>
<span class=p>)</span>
<span class=k>def</span><span class=w> </span><span class=nf>docs</span><span class=p>(</span><span class=n>ctx</span><span class=p>):</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;mkdocs build&quot;</span><span class=p>)</span>
</code></pre></div> <p>By default, <code>skip_reason</code> will be "duty: skipped" where "duty" is replaced by the name of the duty.</p> <h2 id=listing-duties>Listing duties<a class=headerlink href=#listing-duties title="Permanent link">¤</a></h2> <p>Once you have defined some duties, you can list them from the CLI with the <code>-l</code>, <code>--list</code> option. Example:</p> <div class=highlight><pre><span></span><code><span class=gp>$ </span>duty<span class=w> </span>--list
<span class=go>  changelog             Update the changelog in-place with latest commits.</span>
<span class=go>  check                 Check it all!</span>
<span class=go>  check-api             Check for API breaking changes.</span>
<span class=go>  check-dependencies    Check for vulnerabilities in dependencies.</span>
<span class=go>  check-docs            Check if the documentation builds correctly.</span>
<span class=go>  check-quality         Check the code quality.</span>
<span class=go>  check-types           Check that the code is correctly typed.</span>
<span class=go>  clean                 Delete temporary files.</span>
<span class=go>  cov                   Report coverage as text and HTML.</span>
<span class=go>  docs                  Serve the documentation (localhost:8000).</span>
<span class=go>  docs-deploy           Deploy the documentation on GitHub pages.</span>
<span class=go>  format                Run formatting tools on the code.</span>
<span class=go>  release               Release a new Python package.</span>
<span class=go>  test                  Run the test suite.</span>
</code></pre></div> <p>You can also show help for given duties with the <code>-h</code>, <code>--help</code> option:</p> <div class=highlight><pre><span></span><code><span class=gp>$ </span>duty<span class=w> </span>--help<span class=w> </span>release
<span class=go>usage: duty release [-c {stdout,stderr,both,none}] [-f {pretty,tap}] [-y | -Y] [-p | -P] [-q | -Q] [-s | -S] [-z | -Z]</span>

<span class=go>Release a new Python package.</span>

<span class=go>Parameters:</span>
<span class=go>    ctx: The context instance (passed automatically).</span>
<span class=go>    version: The new version number to use.</span>

<span class=go>options:</span>
<span class=go>  -c {stdout,stderr,both,none}, --capture {stdout,stderr,both,none}</span>
<span class=go>                        Which output to capture. Colors are supported with &#39;both&#39; only, unless the command has a &#39;force color&#39; option.</span>
<span class=go>  -f {pretty,tap}, --fmt {pretty,tap}, --format {pretty,tap}</span>
<span class=go>                        Output format. Pass your own Jinja2 template as a string with &#39;-f custom=TEMPLATE&#39;. Available variables: command, title (command or title passed with -t), code (exit</span>
<span class=go>                        status), success (boolean), failure (boolean), number (command number passed with -n), output (command output), nofail (boolean), quiet (boolean), silent (boolean).</span>
<span class=go>                        Available filters: indent (textwrap.indent).</span>
<span class=go>  -y, --pty             Enable the use of a pseudo-terminal. PTY doesn&#39;t allow programs to use standard input.</span>
<span class=go>  -Y, --no-pty          Disable the use of a pseudo-terminal. PTY doesn&#39;t allow programs to use standard input.</span>
<span class=go>  -p, --progress        Print progress while running a command.</span>
<span class=go>  -P, --no-progress     Don&#39;t print progress while running a command.</span>
<span class=go>  -q, --quiet           Don&#39;t print the command output, even if it failed.</span>
<span class=go>  -Q, --no-quiet        Print the command output when it fails.</span>
<span class=go>  -s, --silent          Don&#39;t print anything.</span>
<span class=go>  -S, --no-silent       Print output as usual.</span>
<span class=go>  -z, --zero, --nofail  Don&#39;t fail. Always return a success (0) exit code.</span>
<span class=go>  -Z, --no-zero, --strict</span>
<span class=go>                        Return the original exit code.</span>
</code></pre></div> <p>It prints the docstring of the corresponding function as well as all the duty options you can use (same options for every duties).</p> <h2 id=running-duties>Running duties<a class=headerlink href=#running-duties title="Permanent link">¤</a></h2> <p>To run a duty, simply use:</p> <div class=highlight><pre><span></span><code>duty<span class=w> </span>clean
</code></pre></div> <p>If you are using <a href=https://github.com/python-poetry/poetry>Poetry</a> or <a href=https://github.com/frostming/pdm>PDM</a>:</p> <div class=highlight><pre><span></span><code>poetry<span class=w> </span>run<span class=w> </span>duty<span class=w> </span>clean
pdm<span class=w> </span>run<span class=w> </span>duty<span class=w> </span>clean
</code></pre></div> <p>You can pass multiple duties in one command:</p> <div class=highlight><pre><span></span><code>duty<span class=w> </span>clean<span class=w> </span>docs
</code></pre></div> <h3 id=passing-parameters>Passing parameters<a class=headerlink href=#passing-parameters title="Permanent link">¤</a></h3> <p>Duties can accept arguments (or parameters):</p> <div class=highlight><pre><span></span><code><span class=nd>@duty</span>
<span class=k>def</span><span class=w> </span><span class=nf>docs</span><span class=p>(</span><span class=n>ctx</span><span class=p>,</span> <span class=n>serve</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>False</span><span class=p>):</span>
    <span class=n>command</span> <span class=o>=</span> <span class=s2>&quot;serve&quot;</span> <span class=k>if</span> <span class=n>serve</span> <span class=k>else</span> <span class=s2>&quot;build&quot;</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;mkdocs </span><span class=si>{</span><span class=n>command</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</code></pre></div> <p>When passing the argument from the command line, it will be type-casted using the parameter annotation in the duty's signature. If there is no annotation but a default value, it will be type-casted using the type of the default value.</p> <p>We support any type that is callable and accepts one positional argument (a string), as well as optional types (<code>Optional[...]</code>, <code>... | None</code>) and union types (<code>Union[..., ...]</code>, <code>... | ...</code>).</p> <p>The <code>bool</code> type uses a special conversion table:</p> <table> <thead> <tr> <th>Value (case-insensitive)</th> <th>Result</th> </tr> </thead> <tbody> <tr> <td><code>""</code> (empty string)</td> <td><code>False</code></td> </tr> <tr> <td><code>"0"</code></td> <td><code>False</code></td> </tr> <tr> <td><code>"off"</code></td> <td><code>False</code></td> </tr> <tr> <td><code>"n"</code></td> <td><code>False</code></td> </tr> <tr> <td><code>"no"</code></td> <td><code>False</code></td> </tr> <tr> <td><code>"false"</code></td> <td><code>False</code></td> </tr> <tr> <td>anything else (including <code>"-1"</code>)</td> <td><code>True</code></td> </tr> </tbody> </table> <p>To pass a parameter as a keyword argument, use the <code>name=value</code> form:</p> <div class=highlight><pre><span></span><code>duty<span class=w> </span>docs<span class=w> </span><span class=nv>serve</span><span class=o>=</span>yes<span class=w>  </span><span class=c1># --&gt; serve = True</span>
</code></pre></div> <p>You can use your own custom types as well:</p> <div class=highlight><pre><span></span><code><span class=k>class</span><span class=w> </span><span class=nc>Point</span><span class=p>:</span>
    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>xy</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>x</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>y</span> <span class=o>=</span> <span class=n>xy</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&quot;,&quot;</span><span class=p>)</span>


<span class=nd>@duty</span>
<span class=k>def</span><span class=w> </span><span class=nf>shoot</span><span class=p>(</span><span class=n>ctx</span><span class=p>,</span> <span class=n>point</span><span class=p>:</span> <span class=n>Point</span><span class=p>):</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;shoot -x </span><span class=si>{</span><span class=n>point</span><span class=o>.</span><span class=n>x</span><span class=si>}</span><span class=s2> -y </span><span class=si>{</span><span class=n>point</span><span class=o>.</span><span class=n>y</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</code></pre></div> <p>Then, when running the duty:</p> <div class=highlight><pre><span></span><code>duty<span class=w> </span>shoot<span class=w> </span><span class=nv>point</span><span class=o>=</span><span class=m>5</span>,15
</code></pre></div> <p>You can also pass parameters as positional arguments:</p> <div class=highlight><pre><span></span><code>duty<span class=w> </span>shoot<span class=w> </span><span class=m>5</span>,15
</code></pre></div> <div class="admonition warning"> <p class=admonition-title>Limitation with positional arguments</p> <p> When passing positional arguments, make sure there is no overlap between other duties' names and the argument value, otherwise <code>duty</code> will not be able to parse the command correctly.</p> </div> <p>If your duty accepts variadic positional arguments, those can be passed too from the command line:</p> <div class=highlight><pre><span></span><code><span class=nd>@duty</span>
<span class=k>def</span><span class=w> </span><span class=nf>shout</span><span class=p>(</span><span class=n>ctx</span><span class=p>,</span> <span class=o>*</span><span class=n>names</span><span class=p>):</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=nb>print</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>[</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>name</span><span class=o>.</span><span class=n>upper</span><span class=p>()</span><span class=si>}</span><span class=s2>!&quot;</span> <span class=k>for</span> <span class=n>name</span> <span class=ow>in</span> <span class=n>names</span><span class=p>])</span>
</code></pre></div> <div class=highlight><pre><span></span><code>duty<span class=w> </span>shout<span class=w> </span>herbert<span class=w> </span>marvin
</code></pre></div> <p>This can also be used to pass additional CLI flags to commands or duty tools. If the flags clash with duty's own options, add <code>--</code> first:</p> <div class=highlight><pre><span></span><code><span class=kn>from</span><span class=w> </span><span class=nn>duty</span><span class=w> </span><span class=kn>import</span> <span class=n>duty</span><span class=p>,</span> <span class=n>tools</span>

<span class=nd>@duty</span>
<span class=k>def</span><span class=w> </span><span class=nf>docs</span><span class=p>(</span><span class=n>ctx</span><span class=p>,</span> <span class=o>*</span><span class=n>cli_args</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>tools</span><span class=o>.</span><span class=n>mkdocs</span><span class=o>.</span><span class=n>serve</span><span class=p>()</span><span class=o>.</span><span class=n>add_args</span><span class=p>(</span><span class=o>*</span><span class=n>cli_args</span><span class=p>),</span> <span class=n>capture</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code>duty<span class=w> </span>docs<span class=w> </span>--<span class=w> </span>-vs<span class=w> </span>-f<span class=w> </span>mkdocs.yml
</code></pre></div> <h3 id=passing-options>Passing options<a class=headerlink href=#passing-options title="Permanent link">¤</a></h3> <p>Usage summary:</p> <div class=highlight><pre><span></span><code>duty [GLOBAL_OPTS...] [DUTY [DUTY_OPTS...] [DUTY_PARAMS...]...]
</code></pre></div> <h4 id=global-options>Global options<a class=headerlink href=#global-options title="Permanent link">¤</a></h4> <p>The <code>duty</code> command line tool accepts global options that will affect all the duties selected to run. These options are the same you can use in <code>ctx.run()</code> calls, except for <code>number</code> and <code>title</code> (because it wouldn't make sense).</p> <p>The specified global options will <em>override</em> the default options of duties, as well as the options passed in <code>ctx.run()</code> calls!</p> <p>For example, with a duty declaring these options:</p> <div class=highlight><pre><span></span><code><span class=nd>@duty</span><span class=p>(</span><span class=n>capture</span><span class=o>=</span><span class=s2>&quot;both&quot;</span><span class=p>)</span>
<span class=k>def</span><span class=w> </span><span class=nf>play</span><span class=p>(</span><span class=n>ctx</span><span class=p>,</span> <span class=n>file</span><span class=p>):</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;play </span><span class=si>{</span><span class=n>file</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>,</span> <span class=n>nofail</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</code></pre></div> <p>...you can override both the <code>capture</code> and <code>nofail</code> options like this:</p> <div class=highlight><pre><span></span><code>duty<span class=w> </span>--capture<span class=o>=</span>none<span class=w> </span>--strict<span class=w> </span>play<span class=w> </span>this-file.mp4
<span class=c1># or with the short options</span>
duty<span class=w> </span>-Zc<span class=w> </span>none<span class=w> </span>play<span class=w> </span>this-file.mp4
</code></pre></div> <h4 id=local-options>Local options<a class=headerlink href=#local-options title="Permanent link">¤</a></h4> <p>Local options are the same as global options. Instead of passing them to <code>duty</code> directly, you can pass them to a specific duty on the command line. If we use the previous example again:</p> <div class=highlight><pre><span></span><code>duty<span class=w> </span>play<span class=w> </span>-Zc<span class=w> </span>none<span class=w> </span>this-file.mp4
</code></pre></div> <p>It allows to use different options for different duties selected on the command line. In the following example, the <code>format</code> and <code>check</code> duties will have their output captured, while the <code>test</code> duty will not:</p> <div class=highlight><pre><span></span><code>duty<span class=w> </span>-cboth<span class=w> </span>format<span class=w> </span>check<span class=w> </span><span class=nb>test</span><span class=w> </span>-cnone
</code></pre></div> <h4 id=preventing-options-overrides-from-the-cli>Preventing options overrides from the CLI<a class=headerlink href=#preventing-options-overrides-from-the-cli title="Permanent link">¤</a></h4> <p>If for some reason you would like to prevent the ability to override an option with the command line global or local options, pass <code>allow_overrides=False</code> to your <code>ctx.run()</code> call, or even to your <code>ctx.options()</code> context manager:</p> <div class=highlight><pre><span></span><code><span class=nd>@duty</span>
<span class=k>def</span><span class=w> </span><span class=nf>run_scripts</span><span class=p>(</span><span class=n>ctx</span><span class=p>):</span>
    <span class=c1># no option can be changed from the CLI for the following run</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;bash script1.sh&quot;</span><span class=p>,</span> <span class=n>quiet</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>allow_overrides</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>

    <span class=c1># not for these runs either</span>
    <span class=k>with</span> <span class=n>ctx</span><span class=o>.</span><span class=n>options</span><span class=p>(</span><span class=n>nofail</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>allow_overrides</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
        <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;bash script2.sh&quot;</span><span class=p>)</span>
        <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;bash script3.sh&quot;</span><span class=p>)</span>
</code></pre></div> <h3 id=capturing-commands-output>Capturing commands output<a class=headerlink href=#capturing-commands-output title="Permanent link">¤</a></h3> <p>When running a command through <code>ctx.run()</code>, you can choose to capture its standard output, its standard error, both, or none.</p> <p>Captured output is then available as an <code>output</code> variable when <a href=#formatting-duty-ouput>formatting duty's output</a>.</p> <ul> <li><code>capture=stdout</code> will capture <em>both</em> stdout and stderr, but will only make <em>stdout</em> available while formatting</li> <li><code>capture=stderr</code> will capture <em>both</em> stdout and stderr, but will only make <em>stderr</em> available while formatting</li> <li><code>capture=both</code> will capture both stdout and stderr as one single stream, and will make it available while formatting</li> <li><code>capture=none</code> will not capture anything, and both stdout and stderr <em>will be printed in real-time to the console</em></li> </ul> <p>It is not possible to capture only stdout, or only stderr, and let the other one be printed to the console. Capturing one is capturing both, but discarding the other.</p> <div class="admonition warning"> <p class=admonition-title>Windows quirks</p> <p> On Windows you might need to set the following environment variables to allow proper output capture: <code>PYTHONLEGACYWINDOWSSTDIO=1</code>, <code>PYTHONUTF8=1</code>, <code>PYTHONIOENCODING=UTF8</code>. If the <code>✓</code> and <code>✗</code> characters are mangled, try changing them by <a href=#formatting-duty-output>customizing the output format</a>.</p> </div> <h3 id=formatting-duty-output>Formatting duty output<a class=headerlink href=#formatting-duty-output title="Permanent link">¤</a></h3> <p>Thanks to its underlying <a href=https://github.com/pawamoy/failprint><code>failprint</code></a> dependency, it is possible to change the output of command runs. The output of a command is rendered using a Jinja template string. For example, the two builtin <code>failprint</code> formats are:</p> <ul> <li> <p><code>pretty</code> (default) <div class=highlight><pre><span></span><code><span class=cp>{%</span> <span class=k>if</span> <span class=nv>success</span> <span class=cp>%}</span><span class=x>&lt;green&gt;✓&lt;/green&gt;</span>
<span class=cp>{%</span> <span class=k>elif</span> <span class=nv>nofail</span> <span class=cp>%}</span><span class=x>&lt;yellow&gt;✗&lt;/yellow&gt;</span>
<span class=cp>{%</span> <span class=k>else</span> <span class=cp>%}</span><span class=x>&lt;red&gt;✗&lt;/red&gt;</span><span class=cp>{%</span> <span class=k>endif</span> <span class=cp>%}</span>
<span class=x>&lt;bold&gt;</span><span class=cp>{{</span> <span class=nv>title</span> <span class=k>or</span> <span class=nv>command</span> <span class=cp>}}</span><span class=x>&lt;/bold&gt;</span>
<span class=cp>{%</span> <span class=k>if</span> <span class=nv>failure</span> <span class=cp>%}</span><span class=x> (</span><span class=cp>{{</span> <span class=nv>code</span> <span class=cp>}}</span><span class=x>)</span><span class=cp>{%</span> <span class=k>endif</span> <span class=cp>%}</span>
<span class=cp>{%</span> <span class=k>if</span> <span class=nv>failure</span> <span class=k>and</span> <span class=nv>output</span> <span class=k>and</span> <span class=k>not</span> <span class=nv>quiet</span> <span class=cp>%}</span><span class=x>\n</span>
<span class=cp>{{</span> <span class=o>(</span><span class=s1>&#39;  &gt; &#39;</span> <span class=o>+</span> <span class=nv>command</span> <span class=o>+</span> <span class=s1>&#39;\n&#39;</span><span class=o>)</span> <span class=k>if</span> <span class=nv>title</span> <span class=k>else</span> <span class=s1>&#39;&#39;</span> <span class=cp>}}</span>
<span class=cp>{{</span> <span class=nv>output</span><span class=o>|</span><span class=nf>indent</span><span class=o>(</span><span class=m>2</span> <span class=o>*</span> <span class=s1>&#39; &#39;</span><span class=o>)</span> <span class=cp>}}{%</span> <span class=k>endif</span> <span class=cp>%}</span>
</code></pre></div> Its "progress" template is <code>&gt; {{ title or command }}</code>.</p> </li> <li> <p><code>tap</code> <div class=highlight><pre><span></span><code><span class=cp>{%</span> <span class=k>if</span> <span class=nv>failure</span> <span class=cp>%}</span><span class=x>not </span><span class=cp>{%</span> <span class=k>endif</span> <span class=cp>%}</span><span class=x>ok </span><span class=cp>{{</span> <span class=nv>number</span> <span class=cp>}}</span><span class=x> - </span><span class=cp>{{</span> <span class=nv>title</span> <span class=k>or</span> <span class=nv>command</span> <span class=cp>}}</span>
<span class=cp>{%</span> <span class=k>if</span> <span class=nv>failure</span> <span class=k>and</span> <span class=nv>output</span> <span class=cp>%}</span><span class=x>\n  ---</span>
<span class=x>\n  </span><span class=cp>{{</span> <span class=o>(</span><span class=s1>&#39;command: &#39;</span> <span class=o>+</span> <span class=nv>command</span> <span class=o>+</span> <span class=s1>&#39;\n  &#39;</span><span class=o>)</span> <span class=k>if</span> <span class=nv>title</span> <span class=k>else</span> <span class=s1>&#39;&#39;</span> <span class=cp>}}</span>
<span class=x>output: |\n</span><span class=cp>{{</span> <span class=nv>output</span><span class=o>|</span><span class=nf>indent</span><span class=o>(</span><span class=m>4</span> <span class=o>*</span> <span class=s1>&#39; &#39;</span><span class=o>)</span> <span class=cp>}}</span><span class=x>\n  ...</span><span class=cp>{%</span> <span class=k>endif</span> <span class=cp>%}</span>
</code></pre></div></p> </li> </ul> <p>As you can see there are variables you can use in your format template:</p> <table> <thead> <tr> <th>Variable</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>command</code></td> <td>A stringified version of the command.</td> </tr> <tr> <td><code>title</code></td> <td>The title passed with the <code>title</code> option.</td> </tr> <tr> <td><code>code</code></td> <td>The command exit status.</td> </tr> <tr> <td><code>success</code></td> <td>A boolean indicating if the command succeeded.</td> </tr> <tr> <td><code>failure</code></td> <td>A boolean indicating if the command failed.</td> </tr> <tr> <td><code>number</code></td> <td>The command number passed with the <code>number</code> option.</td> </tr> <tr> <td><code>output</code></td> <td>The command output (stdout, stderr, both or none, depending on the <code>capture</code> option).</td> </tr> <tr> <td><code>nofail</code></td> <td>A boolean indicating if the command was allowed to fail.</td> </tr> <tr> <td><code>quiet</code></td> <td>A boolean instructing to be quiet, i.e. don't print the command output even if it failed.</td> </tr> <tr> <td><code>silent</code></td> <td>A boolean indicating to be silent, i.e. don't print anything.</td> </tr> </tbody> </table> <p>There is also one Jinja filter available</p> <table> <thead> <tr> <th>Filter</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>indent</code></td> <td>The <a href=https://docs.python.org/3/library/textwrap.html#textwrap.indent><code>textwrap.indent</code></a> function</td> </tr> </tbody> </table> <p>To select a different format than the default one, or to provide your own, you can use the <code>fmt</code> option of <code>ctx.run()</code>, the <code>--format</code> CLI option (global and local), and the <code>FAILPRINT_FORMAT</code> environment variable.</p> <p>For example, here is how to use the <code>tap</code> format:</p> <div class=highlight><pre><span></span><code><span class=c1># in the ctx.run() call</span>
<span class=nd>@duty</span>
<span class=k>def</span><span class=w> </span><span class=nf>task1</span><span class=p>(</span><span class=n>ctx</span><span class=p>):</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;echo failed &amp;&amp; false&quot;</span><span class=p>,</span> <span class=n>fmt</span><span class=o>=</span><span class=s2>&quot;tap&quot;</span><span class=p>)</span>


<span class=c1># or as a default duty option</span>
<span class=nd>@duty</span><span class=p>(</span><span class=n>fmt</span><span class=o>=</span><span class=s2>&quot;tap&quot;</span><span class=p>)</span>
<span class=k>def</span><span class=w> </span><span class=nf>task2</span><span class=p>(</span><span class=n>ctx</span><span class=p>):</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;echo failed &amp;&amp; false&quot;</span><span class=p>)</span>
    <span class=n>ctx</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=s2>&quot;echo failed &amp;&amp; false&quot;</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1># or with the CLI global option</span>
duty<span class=w> </span>--format<span class=w> </span>tap<span class=w> </span>task1<span class=w> </span>task2

<span class=c1># or with a CLI local option</span>
duty<span class=w> </span>task1<span class=w> </span>-ftap<span class=w> </span>task2

<span class=c1># or with an environment variable</span>
<span class=nv>FAILPRINT_FORMAT</span><span class=o>=</span>tap<span class=w> </span>duty<span class=w> </span>task1<span class=w> </span>task2
</code></pre></div> <p>To use your own format template, just make the value of the <code>fmt</code> option start with <code>custom=</code>. For example, with an environment variable:</p> <div class=highlight><pre><span></span><code><span class=nb>export</span><span class=w> </span><span class=nv>FAILPRINT_FORMAT</span><span class=o>=</span><span class=s2>&quot;custom={{output}}&quot;</span>
<span class=c1># always print the captured output, nothing else</span>

duty<span class=w> </span>task1<span class=w> </span>task2
</code></pre></div> <h3 id=shell-completions>Shell completions<a class=headerlink href=#shell-completions title="Permanent link">¤</a></h3> <p>You can enable auto-completion in Bash with these commands:</p> <div class=highlight><pre><span></span><code><span class=nv>completions_dir</span><span class=o>=</span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>BASH_COMPLETION_USER_DIR</span><span class=k>:-</span><span class=si>${</span><span class=nv>XDG_DATA_HOME</span><span class=k>:-</span><span class=nv>$HOME</span><span class=p>/.local/share</span><span class=si>}</span><span class=p>/bash-completion</span><span class=si>}</span><span class=s2>/completions&quot;</span>
mkdir<span class=w> </span>-p<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>completions_dir</span><span class=si>}</span><span class=s2>&quot;</span>
duty<span class=w> </span>--completion<span class=w> </span>&gt;<span class=w> </span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>completions_dir</span><span class=si>}</span><span class=s2>/duty&quot;</span>
</code></pre></div> <p>Only Bash is supported for now.</p> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="July 22, 2025 13:00:04 UTC"><span class=timeago datetime=2025-07-22T13:00:04+00:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="July 22, 2025 13:00:04 UTC">2025-07-22</span> </span> <span class=md-source-file__fact> <span class=md-icon title=Created> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="February 6, 2021 17:57:31 UTC"><span class=timeago datetime=2021-02-06T17:57:31+00:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="February 6, 2021 17:57:31 UTC">2021-02-06</span> </span> </aside> <form class=md-feedback name=feedback hidden> <fieldset> <legend class=md-feedback__title> Was this page helpful? </legend> <div class=md-feedback__inner> <div class=md-feedback__list> <button class="md-feedback__icon md-icon" type=submit title="This page was helpful" data-md-value=1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81"/></svg> </button> <button class="md-feedback__icon md-icon" type=submit title="This page could be improved" data-md-value=0> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14"/></svg> </button> </div> <div class=md-feedback__note> <div data-md-value=1 hidden> Thanks for your feedback! </div> <div data-md-value=0 hidden> Let us know how we can improve this page. </div> </div> </div> </fieldset> </form> <!-- Giscus --> <!-- https://squidfunk.github.io/mkdocs-material/setup/adding-a-comment-system/#giscus-integration --> <div id=feedback style="display: none;"> <h2 id=__comments>Feedback</h2> <script src=https://giscus.app/client.js data-repo=pawamoy/duty data-repo-id="MDEwOlJlcG9zaXRvcnkzMDA2OTgwNjQ=" data-category=Documentation data-category-id=DIC_kwDOEexJ0M4ChrXD data-mapping=pathname data-strict=1 data-reactions-enabled=0 data-emit-metadata=0 data-input-position=top data-theme=preferred_color_scheme data-lang=en data-loading=lazy crossorigin=anonymous async>
    </script> <!-- Synchronize Giscus theme with palette --> <script>
        var giscus = document.querySelector("script[src*=giscus]")

        // Set palette on initial load
        var palette = __md_get("__palette")
        if (palette && typeof palette.color === "object") {
            var theme = palette.color.scheme === "slate"
                ? "transparent_dark"
                : "light"

            // Instruct Giscus to set theme
            giscus.setAttribute("data-theme", theme)
        }

        // Register event handlers after documented loaded
        document.addEventListener("DOMContentLoaded", function() {
            var ref = document.querySelector("[data-md-component=palette]")
            ref.addEventListener("change", function() {
                var palette = __md_get("__palette")
                if (palette && typeof palette.color === "object") {
                    var theme = palette.color.scheme === "slate"
                        ? "transparent_dark"
                        : "light"

                    // Instruct Giscus to change theme
                    var frame = document.querySelector(".giscus-frame")
                    frame.contentWindow.postMessage(
                        { giscus: { setConfig: { theme } } },
                        "https://giscus.app"
                    )
                }
            })
        })
    </script> </div> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../license/ class="md-footer__link md-footer__link--prev" aria-label="Previous: License"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> License </div> </div> </a> <a href=../reference/api/ class="md-footer__link md-footer__link--next" aria-label="Next: API reference"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> API reference </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2020 Timothée Mazzucotelli </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/pawamoy target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://fosstodon.org/@pawamoy target=_blank rel="noopener me" title=fosstodon.org class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M433 179.1c0-97.2-63.7-125.7-63.7-125.7-62.5-28.7-228.6-28.4-290.5 0 0 0-63.7 28.5-63.7 125.7 0 115.7-6.6 259.4 105.6 289.1 40.5 10.7 75.3 13 103.3 11.4 50.8-2.8 79.3-18.1 79.3-18.1l-1.7-36.9s-36.3 11.4-77.1 10.1c-40.4-1.4-83-4.4-89.6-54-.6-4.6-.9-9.3-.9-13.9 85.6 20.9 158.7 9.1 178.7 6.7 56.1-6.7 105-41.3 111.2-72.9 9.8-49.8 9-121.5 9-121.5zm-75.1 125.2h-46.6V190.1c0-49.7-64-51.6-64 6.9v62.5H201V197c0-58.5-64-56.6-64-6.9v114.2H90.3c0-122.1-5.2-147.9 18.4-175 25.9-28.9 79.8-30.8 103.8 6.1l11.6 19.5 11.6-19.5c24.1-37.1 78.1-34.8 103.8-6.1 23.7 27.3 18.4 53 18.4 175"/></svg> </a> <a href=https://twitter.com/pawamoy target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M459.4 151.7c.3 4.5.3 9.1.3 13.6 0 138.7-105.6 298.6-298.6 298.6-59.5 0-114.7-17.2-161.1-47.1 8.4 1 16.6 1.3 25.3 1.3 49.1 0 94.2-16.6 130.3-44.8-46.1-1-84.8-31.2-98.1-72.8 6.5 1 13 1.6 19.8 1.6 9.4 0 18.8-1.3 27.6-3.6-48.1-9.7-84.1-52-84.1-103v-1.3c14 7.8 30.2 12.7 47.4 13.3-28.3-18.8-46.8-51-46.8-87.4 0-19.5 5.2-37.4 14.3-53C87.4 130.8 165 172.4 252.1 176.9c-1.6-7.8-2.6-15.9-2.6-24C249.5 95.1 296.3 48 354.4 48c30.2 0 57.5 12.7 76.7 33.1 23.7-4.5 46.5-13.3 66.6-25.3-7.8 24.4-24.4 44.8-46.1 57.8 21.1-2.3 41.6-8.1 60.4-16.2-14.3 20.8-32.2 39.3-52.6 54.3"/></svg> </a> <a href=https://gitter.im/duty/community target=_blank rel=noopener title=gitter.im class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 384 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M66.4 322.5H16V0h50.4zM166.9 76.1h-50.4V512h50.4zm100.6 0h-50.4V512h50.4zM368 76h-50.4v247H368z"/></svg> </a> <a href=https://pypi.org/project/duty/ target=_blank rel=noopener title=pypi.org class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6M286.2 444.7a20.4 20.4 0 1 1 0-40.7 20.4 20.4 0 1 1 0 40.7M167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4m-6.6-183.4a20.4 20.4 0 1 1 0 40.8 20.4 20.4 0 1 1 0-40.8"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"annotate": null, "base": "..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tooltips", "navigation.footer", "navigation.instant.preview", "navigation.path", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "search.highlight", "search.suggest", "toc.follow"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../assets/javascripts/bundle.79ae519e.min.js></script> <script src=../assets/_markdown_exec_pyodide.js></script> <script src=../js/timeago.min.js></script> <script src=../js/timeago_mkdocs_material.js></script> <script src=../js/feedback.js></script> </body> </html>